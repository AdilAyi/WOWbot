function SiteView(){this.rootNode=null,this.data=null}function MapIcon(e,t,a,n){this.position=e,this.map=t,this.data=a,this.layerType=n,this.fetchedData=null,this.fetchTimer=null,this.hasLatestData=!0,value=KNMI.Map.Resolutions.getValue(this.data.property),this.html=this.getHtml()}function fromLatLngToPoint(e,t){var a=t.getProjection().fromLatLngToPoint(t.getBounds().getNorthEast()),n=t.getProjection().fromLatLngToPoint(t.getBounds().getSouthWest()),o=Math.pow(2,t.getZoom()),i=t.getProjection().fromLatLngToPoint(e);return new google.maps.Point((i.x-n.x)*o,(i.y-a.y)*o)}function SearchHelper(e){this.rootNode=e,this.initBinds()}SiteView.prototype.initialise=function(e){this.rootNode=e},SiteView.prototype.show=function(){this.rootNode.find(".site-thumb").length&&this.createImageGallery(),this.rootNode.find("[data-property]").length&&this.fillDataProperties()},SiteView.prototype.newSiteData=function(e){this.data=e},SiteView.prototype.hide=function(){},SiteView.prototype.destroy=function(){this.resetForm()},SiteView.prototype.resetForm=function(){if(!KNMI.Map.CompareStations.isActive()){var e=this.rootNode.find("form");e.length&&e.find("input").each(function(){var e=$(this);switch(e.attr("type")){case"checkbox":e.prop("checked",!1).trigger("change");break;case"text":case"hidden":e.val("")}})}},SiteView.prototype.fillDataProperties=function(){var e=this.data;this.rootNode.find("[data-property]").each(function(){var t=$(this),a=t.attr("data-parse"),n=t.attr("data-suffix"),o=t.attr("data-property").split(".");if(null!==e.report){var i=e,r=1==i.site.official;void 0!==t.parent().attr("data-test")&&(r?t.parent().hide():t.parent().show());for(var s=0,l=o.length;s<l;s++)i=null!==i[o[s]]?i[o[s]]:"-";$.isArray(i)&&(i=i.toString()),"date"===a&&(i=moment(i,KNMI.Config.global.dateFormat).format("DD-MM-YYYY HH:mm")),i=KNMI.Config.translateKey(i),void 0!==n&&null!==i&&(i+=n),t.html(i)}})},SiteView.prototype.createImageGallery=function(){function e(e){var n={index:e,history:!1},o=new PhotoSwipe(a,PhotoSwipeUI_Default,t,n);o.init()}var t=[],a=$(".pswp")[0],n=this.rootNode.find(".site-thumb");n.length;n.each(function(a,n){!function(){var o=$(n),i=o.find("img"),r=i[0].src+"?"+(new Date).getTime()*Math.random(),s=new Image;s.src=r,s.onload=function(){var e={src:this.src+10*Math.random(),w:this.width,h:this.height};t.push(e)},o.off("click").on("click",function(t){e(a),t.preventDefault()})}()})};var FETCH_TIMER_SPEED=50;MapIcon.prototype=new google.maps.OverlayView,MapIcon.prototype.getHtml=function(){var e=this,t=KNMI.Map.Resolutions.getResolution(this.data.property,this.data.type),a=document.createElement("div"),n='<div       data-site-id="'+e.data.id+'"       data-report-id="'+e.data.report_id+'"       class="marker holder '+e.layerType+" "+t+'"       data-placement="top" >           <span class="value">'+value+"</span>       </div>";return a.innerHTML=n,a.firstChild},MapIcon.prototype.onAdd=function(){var e=this.getPanes();e.overlayImage.style.zIndex=2,e.overlayImage.appendChild(this.html)},MapIcon.prototype.draw=function(){var e=this,t=this.getProjection(),a=t.fromLatLngToDivPixel(this.position);"tooltip-"+e.data.id;this.html.style.left=a.x-this.html.offsetWidth/2+"px",this.html.style.top=a.y-this.html.offsetHeight/2+"px",this.html.onclick=function(){e.click()},this.html.onmouseover=function(){var t=fromLatLngToPoint(e.position,e.map);e.fetchedData||e.fetchSiteData(function(a){e.showTooltip(t.x,t.y-e.html.offsetHeight/2)}),e.showTooltip(t.x,t.y-e.html.offsetHeight/2)},this.html.onmouseout=function(){e.hideTooltip()}},MapIcon.prototype.showTooltip=function(e,t){var a=this,n=KNMI.Map.Map.getActiveToolTip();n&&n.remove(),n=$(a.showSiteData()),KNMI.Map.Map.setActiveToolTip(n),n[0].style.left=e+"px",n[0].style.top=t+$(".navbar").height()+"px",$("body").append(n)},MapIcon.prototype.hideTooltip=function(){KNMI.Map.Map.getActiveToolTip()&&KNMI.Map.Map.removeActiveToolTip(),clearTimeout(this.fetchTimer)},MapIcon.prototype.showSiteData=function(){var e,t=this,a=this.data.name||"Station",n=null===this.fetchedData,o=function(e,t){switch(e){case"wind_direction":var a=t.replace(/\s*\graden\s*/g,"&deg ");return a;default:return t}},i=function(){var e=KNMI.Map.Resolutions.getWeatherIconSet(),a=[];t.fetchedData.measurements&&$.each(t.fetchedData.measurements,function(t,n){null!==n&&void 0!==e[t]&&a.push({iconClass:e[t].className,value:o(t,n),index:e[t].index})}),a.sort(function(e,t){return parseFloat(e.index)-parseFloat(t.index)});var n=a.map(function(e){return'<li>                     <i class="wi '+e.iconClass+'"></i>                     <span class="tooltip-value">'+e.value+" </span>                 </li>"});return"<ul>"+n.join("")+"</ul>"};e=n?"<p>Stationsdata laden...</p>":this.hasLatestData?i():"";var r='<div class="tooltip-holder">             <div class="tooltip top">                 <div class="tooltip-arrow"></div>                 <div class="tooltip-inner">                     <h3><strong>'+a+"</strong></h3>                     "+e+"                 </div>             </div>         </div>";return r},MapIcon.prototype.fetchSiteData=function(e){if(!this.loading&&!this.fetchedData){null==this.data.report_id&&(this.data.report_id="",this.hasLatestData=!1);var t=this.data.id,a=this.data.report_id,n="/sites/"+t+"?report_id="+a,o=this;o.fetchTimer&&clearTimeout(o.fetchTimer),o.fetchTimer=setTimeout(function(){o.loading=!0,KNMI.Components.Request.makeSiteDataRequest(n,function(t){o.loading=!1,o.fetchedData=t,e(t)})},FETCH_TIMER_SPEED)}},MapIcon.prototype.click=function(){var e=this;if(KNMI.Map.CompareStations.compareModeActive())KNMI.Map.CompareStations.addStation(e.data);else if(this.fetchedData)this.hasLatestData||KNMI.Components.InfoWindow.showMessage("warning",KNMI.Config.messages.warning["loaded-last-report"]),KNMI.Site.Modal.openModal(e.fetchedData);else if(KNMI.isMobile()){var t=this.data.id,a=this.data.report_id,n="/sites/"+t+"?report_id="+a;KNMI.Components.Request.makeSiteDataRequest(n,function(e){KNMI.Site.Modal.openModal(e)})}else this.fetchSiteData(function(t){e.fetchedData=t,KNMI.Site.Modal.openModal(e.fetchedData)});e.hideTooltip()},MapIcon.prototype.onRemove=function(){this.html.parentNode.removeChild(this.html)},MapIcon.prototype.setVisible=function(e){this.html&&(this.html.style.display=e?"block":"none")},MapIcon.prototype.focus=function(){},MapIcon.prototype.overwriteHTML=function(e,t){var a=this,n=document.createElement("div"),o='<div       data-site-id="'+a.data.id+'"       data-report-id="'+a.data.report_id+'"       class="marker holder '+e+'"       data-placement="top" >           <span class="value">'+t+"</span>       </div>";n.innerHTML=o,this.html=n.firstChild},MapIcon.prototype.getPosition=function(){return this.position},window.KNMI=function(){var e={},t=function(){String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.move=function(e,t){return this.splice(t,0,this.splice(e,1)[0]),this},Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length>>>0,a=Number(arguments[1])||0;for(a=a<0?Math.ceil(a):Math.floor(a),a<0&&(a+=t);a<t;a++)if(a in this&&this[a]===e)return a;return-1})},a=function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))&&($("body").addClass("mobile"),!0)},n=function(){return navigator.appVersion.indexOf("MSIE 10")!==-1&&($("body").addClass("ie10"),!0)};return onDocReady=function(){e.isMobile=a(),e.isIe10=n(),KNMI.Components.Fallbacks.initialise(),t(),KNMI.Components.CookieHandler.initialise(),KNMI.Map.MapTime.initialise($("#map")),KNMI.Map.Bookmark.initialise(),KNMI.Components.FormHandler.initialise($("#baseForm")),KNMI.Components.InfoWindow.initialise($("#info-window")),KNMI.Map.Map.initialise($("#map")),KNMI.Map.CompareStations.initialise&&KNMI.Map.CompareStations.initialise(),KNMI.Components.Helpers.initialise(),KNMI.Components.Request.initialise(),KNMI.Site.Modal.initialise($("#modal")),void 0!==KNMI.Admin.Handler&&KNMI.Admin.Handler.initialise()},$(function(){onDocReady()}),{browserData:e,isMobile:a}}(),KNMI.Map=KNMI.Map||{},KNMI.Components=KNMI.Components||{},KNMI.Site=KNMI.Site||{},KNMI.Site.Views=KNMI.Site.Views||{},KNMI.Admin=KNMI.Admin||{},KNMI.Map.CompareStations=KNMI.Map.CompareStations||{},KNMI.Components.Fallbacks=function(){return initialise=function(){handlePlaceholders(),handleBackgroundsSize()},handlePlaceholders=function(){Modernizr.input.placeholder||$("[placeholder]").focus(function(){var e=$(this);e.val()==e.attr("placeholder")&&(e.val(""),e.removeClass("placeholder"))}).blur(function(){var e=$(this);""!=e.val()&&e.val()!=e.attr("placeholder")||(e.addClass("placeholder"),e.val(e.attr("placeholder")))}).blur()},handleBackgroundsSize=function(){Modernizr.backgroundsize||($(".banner").css({backgroundSize:"cover"}),$(".table-striped > tbody > tr:nth-child(odd)").each(function(){$(this).addClass("alternate")}))},{initialise:initialise}}(),SearchHelper.prototype.initBinds=function(){var e=this;e.rootNode.autocomplete({minLength:3,source:function(e,t){$.ajax({url:"sites/search",data:{keyword:e.term},success:function(e){t(e.sites)}})},focus:function(t,a){var n=a.item;return null!==n.name?e.rootNode.val(n.name):e.rootNode.val(n.id),!1},change:function(t,a){var n=a.item;null===n&&(n={type:"location",value:e.rootNode.val()}),e.selectValue(n)},select:function(t,a){var n=a.item;return null!==n.name?e.rootNode.val(n.name):e.rootNode.val(n.id),n&&e.selectValue(n),n}}).on("keyup",function(t,a){13===t.keyCode&&e.rootNode.trigger("blur")}).autocomplete("instance")._renderItem=function(e,t){return t.type="geo",$("<li>").append("<a>"+t.id+(null!==t.name?"<br>"+t.name:"")+"</a>").appendTo(e)}},SearchHelper.prototype.triggerSelect=function(){if(""!==this.rootNode.val()&&this.rootNode.val()!==this.rootNode.attr("placeholder")){var e=this.rootNode.data("ui-autocomplete").selectedItem;this.rootNode.data("ui-autocomplete")._trigger("change","autocompletechange",{item:e})}},SearchHelper.prototype.selectValue=function(e){this.rootNode.trigger("valueSelected",[e])},KNMI.Components.Helpers=function(){var e=function(){i($("[data-legend-trigger]")),o($("#welcome-modal")),n($('[data-toggle="tooltip"]')),t($(".faq-link")),r()},t=function(e){if(e.length)for(var t=e,a=10,n=(location.hash.slice(1),$("body > .navbar").outerHeight()),o=0,i=t.length;o<i;o++)!function(){var e=$(t[o]),i=$(e.attr("href"));e.on("click",function(e){e.stopPropagation(),setTimeout(function(){var e=i.offset().top-n-a;$(window,document).scrollTop(e)},10)})}()},a=function(e){$("[data-translate-toproperty]").each(function(t,a){for(var n=$(a),o=n.attr("data-translate-toproperty").split(","),i=o[0],r=o[1].split("."),s=e,l=0,d=r.length;l<d;l++)s=s[r[l]];n.attr(i,s),n.tooltip({placement:"left",container:"body"})})},n=function(e){e.tooltip()},o=function(e){$(e);$("nav .toggle-info").on("click",function(){e.modal("show")})},i=function(e){var t=$("#filter-layers"),a=$("#include-no-data");t.on("change",function(){var e=$(this),t=e.find(":selected"),a=$("[data-legend="+t.attr("data-legend-trigger")+"]");a.addClass("active").siblings().not('[data-type="checkbox"]').removeClass("active")}),a.on("change",function(){var e=$(this),t=(e.attr("type"),$("[data-legend="+e.attr("data-legend-trigger")+"]"));t.toggleClass("active")})},r=function(){function e(){a[n].btn.removeClass("open"),a[n].content.removeClass("open")}function t(){i.off("click.filterBtns").on("click.filterBtns",function(t){var o=$(t.target).hasClass(a.filter.btn.selector.substring(1))||$(t.target).hasClass(a.legenda.btn.selector.substring(1))||$(t.target).parents().hasClass(a.filter.content.selector.substring(1))||$(t.target).parents().hasClass(a.legenda.content.selector.substring(1));null===n||o||(e(),i.off("click.filterBtns"))})}var a={filter:{btn:$(".filters--toggle"),content:$(".panel--filters")},legenda:{btn:$(".legenda--toggle"),content:$(".panel--legenda"),body:$("#legend"),toggle:$(".panel--legenda").find("[href=#legend]")},rainfall:{content:$(".panel--rainfall"),body:$("#rainfall"),toggle:$(".panel--legenda").find("[href=#rainfall]")}},n=null,o=!1,i=$("body"),r=$(window);$(a.filter.btn.selector+","+a.legenda.btn.selector).on("click",function(){var o=!$(this).hasClass("open"),i=$(this).attr("data-target");o?(null!=n&&e(),t(),$(this).addClass("open"),a[i].content.addClass("open")):($(this).removeClass("open"),a[i].content.removeClass("open")),n=o?i:null});var s=function(){o=r.height()<=950;var e=a.legenda.toggle.hasClass("collapsed"),t=a.rainfall.toggle.hasClass("collapsed");o?e||t||a.rainfall.body.collapse("hide"):(a.legenda.body.collapse("show"),a.rainfall.body.collapse("show"))},l=function(e,t,a){t.collapse(),o&&a.collapse("hide")};a.legenda.toggle.on("click",function(e){l("main_legend",a.legenda.body,a.rainfall.body)}),a.rainfall.toggle.on("click",function(e){l("rainfall_legend",a.rainfall.body,a.legenda.body)}),r.on("resize",s),s()};return{initialise:e,initDataToProperties:a}}(),KNMI.Config={global:{dateFormat:"YYYY-MM-DDTHH:mm:ss"},languageMapping:{ucz:"Stedelijke zone",temperature:"Meting luchttemperatuur",reporting:"Waarneemuren",precipitation:"Meting neerslag",exposure:"Ligging",wind:"Meting wind","true":"Ja","false":"Nee","Above Ground Temperature":"Temperatuur","Air Temperature":"Luchttemperatuur","Wet Bulb":"Natteboltemperatuur","Max. Temp. (last 24hr)":"Maximumtemperatuur (24u)","Min. Temp. (last 24hr)":"Minimumtemperatuur (24u)","Concrete Temp.":"Wegdektemperatuur","Grass Temp.":"Grastemperatuur","Soil Measurements":"Bodem","Soil Temp. (at 10cm)":"Bodemtemperatuur (-10cm)","Soil Temp. (at 30cm)":"Bodemtemperatuur (-30cm)","Soil Temp. (at 100cm)":"Bodemtemperatuur (-100cm)","Soil Moisture":"Bodemvochtigheid","Wind Measurements":"Wind","Wind Direction":"Windrichting","Wind Speed":"Windsnelheid","Wind Gust":"Windstoot","Wind Gust Direction":"Richting van windstoot","Weather Codes":"Weercodes","Present Weather":"Actueel weer","Ground State":"Staat van de grond",Visibility:"Horizontaal zicht","Total Cloud Cover":"Totale bedekkingsgraad","Pressure Measurements":"Luchtdruk","Mean Sea-Level Pressure":"Luchtdruk op zeeniveau","Pressure (At Station)":"Luchtdruk op stationsniveau","Misc.":"Diversen","Rainfall Accumulation":"Neerslagsom","Relative Humidity":"Relatieve luchtvochtigheid","Dew Point":"Dauwpunt","Snow Depth":"Sneeuwhoogte",Sunshine:"Zonneschijnduur","Rainfall Rate":"Neerslagintensiteit","Day of Gales":"Dag met Storm","Day of Hail":"Dag met Hagel","Day of Snow":"Dag met Sneeuw","Day of Thunder":"Dag met Onweer","th-date":"Datum","th-details":"Details","th-temperature":"Temperatuur °C","th-rain_rate":"Neerslagintensiteit mm/uur","th-wind_direction":"Windrichting °","th-wind_speed":"Windsnelheid m/s","th-humidity":"Relatieve vochtigheid  %","th-soil_moisture":"Bodemvochtigheid %","th-pressure_msl":"Luchtdruk hPa","exposure-5":"Er bevinden zich geen obstakels binnen een straal van minimaal 10h van de temperatuur‐ of neerslaginstrumenten.","exposure-4":"De meeste obstakels c.q. verwarmde gebouwen bevinden zich binnen een straal van 5h van de temperatuur‐ of neerslaginstrumenten, maar buiten een straal van 2h.","exposure-3":"Er bevinden zich geen significante obstakels c.q. verwarmde gebouwenbinnen een straal van 2h van de temperatuur‐ of neerslaginstrumenten","exposure-2":"De meeste obstakels c.q. verwarmde gebouwen bevinden zich binnen een straal van 2h van de temperatuur‐ of neerslaginstrumenten, maar buiten een straal van 1h","exposure-1":"Er bevinden zich significante obstakels c.q. verwarmde gebouwen binnen een straal van 1h van de temperatuur‐ of neerslaginstrumenten.","exposure-0":"De blootstelling van instrumenten aan zonlicht, wind en neerslag wordt ernstig beperkt door obstakels","exposure-R":"Op een dak gelegen station: Stations op daken voor het meten van temperatuur en neerslag dienen zo veel mogelijk te worden vermeden.","exposure-T":"Station in de buurt van verkeer: De meetapparatuur bevindt zich in de buurt van een openbare snelweg.","exposure-U":"Er is niets bekend over de ligging.","temperature-A":"Standaardinstrumenten in Stevenson‐scherm; in de afgelopen 10 jaar geijkt; minimale classificatie voor ligging locatie = 3.","temperature-B":"Standaardinstrumenten in Stevenson‐scherm of door de AWS‐fabrikant geleverd stralingsscherm; in de afgelopen 10 jaar geijkt; classificatie voor ligging locatie = 2 of 3.","temperature-C":"Standaardinstrumenten in Stevenson‐scherm of door de AWS‐fabrikant geleverd stralingsscherm; classificatie voor ligging locatie = 1 of minder.","temperature-D":"Niet‐standaardinstrumenten en/of niet‐standaardstralingsscherm en/of beschutte locatie; classificatie voor ligging locatie = 1 of minder.","temperature-U":"Er is niets bekend over de instrumenten.","temperature-0":"Op deze locatie worden geen temperatuurmetingen gedaan.","precipitation-A":'Handmatig af te lezen standaardregenmeter (5") of geijkte regenmeter met kantelbakje, op standaardhoogte boven de grond (30 cm); minimale classificatie voor ligging locatie = 3.',"precipitation-B":'Handmatig af te lezen standaardregenmeter (5") of geijkte regenmeter met kantelbakje, waarbij de rand op standaardhoogte boven de grond (30 cm) is aangebracht; minimale classificatie voor ligging locatie = 2 of 3.',"precipitation-C":'Handmatig af te lezen standaardregenmeter (5") of geijkte regenmeter met kantelbakje, waarbij de rand op standaardhoogte boven de grond (30 cm) is aangebracht; minimale classificatie voor ligging locatie = 1 of minder.',"precipitation-D":"Handmatig af te lezen niet‐standaardregenmeter of regenmeter met kantelbakje; classificatie voor ligging locatie = 1 of minder.","precipitation-U":"Er is niets bekend over de instrumenten","precipitation-0":"Op deze locatie worden geen neerslagmetingen gedaan.","wind-A":"De windmeters zijn in de afgelopen 10 jaar geijkt, zijn 10 m boven de grond bevestigd aan een paal of mast, en binnen een straal van 100 m bevinden zich geen obstakels.","wind-B":"De windmeters zijn boven de grond bevestigd aan een paal of mast, en binnen een straal van 50 m bevinden zich geen obstakels.","wind-C":"De windmeters zijn bevestigd aan een gebouw of muur","wind-U":"Er is niets bekend over de instrumenten.","wind-0":"Op deze locatie worden geen windmetingen gedaan.","ucz-1":"Zeer sterk ontwikkelde stedelijke zone met vrijstaande, dicht op elkaar gebouwde en van een façade voorziene hoogbouw, bijv. kantoortorens.","ucz-2":"Zeer sterk ontwikkelde stedelijke zone met een hoge bevolkingsdichtheid en dicht op elkaar staande of aan elkaar gebouwde gebouwen van 2 tot 5 verdiepingen (vaak van baksteen of beton), bijv. stadshuizen.","ucz-3":"Sterk ontwikkelde stedelijke zone met gemiddelde bevolkingsdichtheid met dicht op elkaar gebouwde (rijtjes‐)huizen, winkels en appartementen, bijv. Vinex‐woningen.","ucz-4":"Sterk ontwikkelde stedelijke zone met lage bevolkingsdichtheid met lage bebouwing en veel bestrating, bijv. meubelboulevards en groothandels.","ucz-5":"Matig ontwikkelde voorstedelijke zone met een lage bevolkingsdichtheid met huizen van 1 à 2 verdiepingen, bijv. huizen in buitenwijken.","ucz-6":"Gemengde zone met grote gebouwen in een open landschap, bijv. ziekenhuizen, universiteiten of luchthavens.","ucz-7":"Semi‐landelijke zone met verspreid staande huizen in een natuurlijke of agrarische omgeving, bijv. boerderijen en landhuizen.","ucz-U":"Er is niets bekend over de indeling als stedelijk gebied / stedelijke zone.","reporting-A":"Streeft ernaar altijd om 09:00 GMT een weerrapport aan te leveren. De dagelijkse waarden voor temperatuur en neerslag hebben betrekking op een 24 uur durende standaardperiode van ochtend tot ochtend.","reporting-B":"Streeft ernaar altijd een weerrapport aan te leveren tussen 06:00 en 09:00 GMT. De dagelijkse waarden voor temperatuur en neerslag hebben betrekking op een 24 uur durende standaardperiode van ochtend tot ochtend.","reporting-C":"De dagelijkse waarden voor temperatuur en neerslag hebben betrekking op een 24 uur durende standaardperiode van middernacht tot middernacht. Dit is de standaardinstelling voor de meeste automatische weerstations.","reporting-D":"De sluittijd voor luchttemperatuur en neerslag is anders dan A, B of C hierboven, of er is sprake van extremen die geen betrekking hebben op perioden van 24 uur.","reporting-U":"Er is niets bekend over de meldingsuren."},graph:{gridLineColorYAxis:"#ddd",gridLineColorXAxis:"#ddd",bottomAxisColor:"#ddd",crossHairColor:"#ccc",toolTip:{borderColor:"#fff"}},titles:{tableHeaders:{date:"datum",details:"details"},helpers:{checkDetails:"bekijk details"},globalSite:{siteID:"Station ID:"}},messages:{error:{"invalid-site":'<i class="fa fa-times-circle"></i> Dit meetstation bestaat niet.',"invalid-date":'<i class="fa fa-times-circle"></i> Voer een geldige datum in.',"invalid-time":'<i class="fa fa-times-circle"></i> Voer een geldige tijdstip in.',"invalid-start-date":'<i class="fa fa-times-circle"></i> De start datum mag niet gelijk of hoger zijn dan de einddatum.',"invalid-end-date":'<i class="fa fa-times-circle"></i> De eind datum mag niet gelijk of lager zijn dan de startdatum.',"filter-min":'<i class="fa fa-times-circle"></i> Er moet minimaal 1 filter aan staan',"filter-max":'<i class="fa fa-times-circle"></i> Er mogen maximaal 5 filters aan staan',"location-not-found":'<i class="fa fa-times-circle"></i> De opgegeven locatie is niet gevonden.'},status:{"loading-siteIDs":"<i class='fa fa-exclamation-triangle'></i> De site ID's worden geladen.","loading-stations":"<i class='fa fa-exclamation-triangle'></i>  De stations worden geladen.","loading-nearestSite":"<i class='fa fa-exclamation-triangle'></i> Dichtstbijzijnde station wordt gezocht."},warning:{"loaded-last-report":"<i class='fa fa-exclamation-triangle'></i> De meetwaardes van dit station op het gekozen tijdstip zijn niet beschikbaar. De meest recente data wordt getoond."},success:{"loading-siteIDs":"De site ID's  zijn geladen.","loading-stations":"De stations zijn geladen."}},translateKey:function(e){return void 0!==this.languageMapping[e]?this.languageMapping[e]:e}},KNMI.Components.CookieHandler=function(){var e=function(){t($("#welcome-modal"))},t=function(e){function t(){if(0==i?s.addClass("hidden"):s.removeClass("hidden"),i==r.length-1?l.addClass("hidden"):l.removeClass("hidden"),0!==i){var e=s.find("i")[0].outerHTML,t=r.eq(i-1).attr("data-title").trim();s.html(e+" "+t)}if(i!==r.length-1){var e=l.find("i")[0].outerHTML,a=r.eq(i+1).attr("data-title").trim();l.html(a+" "+e)}}if(!e.length||!e.find(".item").length)return!1;var o=e.find(".carousel"),i=0,r=e.find(".carousel-inner  > .item"),s=e.find(".carousel-control.left"),l=e.find(".carousel-control.right");o.carousel(),carouselIndicators=e.find(".carousel-indicators li"),o.on("slid.bs.carousel",function(e){var a=$(e.currentTarget).find(".active");i=a.index(),carouselIndicators.filter(".active").removeClass("active"),carouselIndicators.eq(i).addClass("active"),t()}),t(),a("is-welcomed")||"true"!=e.attr("data-open")||e.modal("show"),e.on("hide.bs.modal",function(){n("is-welcomed",!0)})},a=function(e){return e?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},n=function(e,t,a,n,o,i){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var r="";if(a)switch(a.constructor){case Number:r=a===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+a;break;case String:r="; expires="+a;break;case Date:r="; expires="+a.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+r+(o?"; domain="+o:"")+(n?"; path="+n:"")+(i?"; secure":""),!0};return{initialise:e,setCookie:n}}(),KNMI.Components.InfoWindow=function(){var e=null,t=null,a=null,n=null,o=5e3,i=null,r={error:"alert-danger",loading:"alert-info",warning:"alert-warning",success:"alert-success"},s=function(n){e=n,e.find(".close").on("click",function(){l()}),t=e.find(".alert"),a=t.find("p")},l=function(n){e.removeClass("show"),a.html(""),setTimeout(function(){t.removeClass(i)},300),n&&n()},d=function(n,s,l){var d=r[n],u=void 0===l?o:l;e.addClass("show"),t.removeClass(i),t.addClass(d),a.html(s),i=d,u>0&&c(u)},c=function(e){null!==n&&clearTimeout(n),n=setTimeout(function(){l()},e)};return{initialise:s,showMessage:d,closeInfoWindow:l}}(),KNMI.Components.Request=function(){var e=null,t=null,a=function(){e=KNMI.Components.FormHandler.getForm()},n=function(){var a=e.serializeArray();t={};for(var n=0,o=a.length;n<o;n++){var i=a[n].name,r=a[n].value;void 0!==t[i]?t[i].push(r):t[i]=[r.length>0?r:"default"]}},o=function(t){var a=e.serialize();n(),KNMI.Components.FormHandler.toggleDisableForm(!0),$("body").addClass("loading-map"),$.ajax({url:"/sites?"+a}).done(function(e){void 0===t?KNMI.Map.Map.showData(e):t(e),KNMI.Components.FormHandler.toggleDisableForm(!1),$("body").removeClass("loading-map")}).fail(function(e){})},i=function(e,t){var a=!1;null!==t&&"null"!==t||(t="",a=!0),$.ajax({url:"/sites/"+e+"?report_id="+t}).done(function(e){a&&KNMI.Components.InfoWindow.showMessage("warning",KNMI.Config.messages.warning["loaded-last-report"]),KNMI.Site.Modal.openModal(e)}).fail(function(e){})},r=function(e,t){$.ajax({url:e}).done(function(e){t(e)}).fail(function(e){t(e)})},s=function(e){$.ajax({url:"/sites"}).done(function(t){e(t)}).fail(function(t){e(t)})},l=function(e){$.ajax({url:"/layers"}).done(function(t){e(t),KNMI.Components.Helpers.initDataToProperties(t)}).fail(function(t){e(t)})};return{initialise:a,makeSitesRequest:o,makeSiteRequest:i,makeLayersRequest:l,makeSiteDataRequest:r,makeGlobalSitesRequest:s,getFilter:function(){return t}}}(),KNMI.Components.FormHandler=function(){var e=null,t=null,a=[],n=function(t){e=t,o(),r($(".searchbox"))},o=function(){e.find("#filter-layers").on("change",function(){KNMI.Components.Request.makeSitesRequest()}),e.find("input").each(function(){var e=$(this);switch(e.attr("type")){case"checkbox":case"radio":e.on("change",function(){"WMS"!==e[0].id&&KNMI.Components.Request.makeSitesRequest()})}}),e.on("keydown",function(e){13===e.keyCode&&e.preventDefault()})},i=function(t){e.find("#layers").find("input").each(function(){$(this).attr("disabled",t)}),e.find("#filter").find("input").each(function(){$(this).attr("disabled",t)})},r=function(e){var t=e.find("#btn-location"),a=new SearchHelper(e.find("#search"));a.rootNode.on("valueSelected",function(e,t){KNMI.Map.Map.searchLocation(t)}),t.on("click",function(){a.triggerSelect()})};return{initialise:n,getLocationsData:function(){return{locationsData:t,locationsList:a}},toggleDisableForm:i,getForm:function(){return e}}}(),KNMI.Components.Validation=function(){var e={},t=KNMI.Config.messages,a=KNMI.Components.InfoWindow,n=[],o=!1,i=null,r=function(t){var a=t.find(".update"),n=t.find("#graph-startdate").parent().find('[name="start"]'),o=t.find("#graph-enddate").parent().find('[name="end"]');t.find("#graph-compare_siteid");i=t.find('[type="checkbox"]'),e.updateBtn=a,e.form=t,n.on("change",function(){p($(this)),h(n,o,n)}),o.on("change",function(){p($(this)),h(n,o,o)});for(var r=0;r<i.length;r++){var s=$(i[r]);s.on("change",function(){d()})}},s=function(e){return!!o&&(m(e)==-1&&n.push(e),e.el.parent().addClass("has-error"),a.showMessage("error",t.error[e.error]),void c())},l=function(e){e.el.parent().removeClass("has-error"),m(e)!=-1&&n.splice(m(e),1),c()},d=function(){var e=i.filter(":checked").length;0==e?s({el:$(i.get(0)).parents(".col-med"),error:"filter-min"}):e>5?s({el:$(i.get(0)).parents(".col-med"),error:"filter-max"}):(l({el:$(i.get(0)).parents(".col-med"),error:"filter-min"}),l({el:$(i.get(0)).parents(".col-med"),error:"filter-max"}))},c=function(){n.length>0?e.updateBtn.attr("disabled",!0):e.updateBtn.attr("disabled",!1)},u=function(){o=!0,d()},m=function(e){for(var t=-1,a=0,o=n.length;a<o;a++){var i=n[a];i.el.get(0)==e.el.get(0)&&i.error==e.error&&(t=a)}return t},p=function(e){var t=moment($(e).val(),KNMI.Config.global.dateFormat).isValid(),a="invalid-date";return t?l({el:e,error:a}):s({el:e,error:a}),t},f=function(e){var t=moment($(e).val(),"HH:mm",!0).isValid(),a="invalid-time";return t?l({el:e,error:a}):s({el:e,error:a}),t},h=function(e,t,a){if(""===t.val()||""===e.val())return!1;var n=KNMI.Config.global.dateFormat,o=moment(e.val(),n).isBefore(moment(t.val(),n)),i="invalid-start-date",r="invalid-end-date";o?(l({el:e,error:i}),l({el:t,error:r})):s("graph-startdate"==a.attr("id")?{el:e,error:i}:{el:t,error:r})},g=function(){n=[],e.form.find(".has-error").removeClass("has-error"),e.form.find("[data-reset]").val(""),o=!1};return{initGraphValidations:r,resetValidations:g,activateValidations:u,validateLayers:d,validateTime:f,isValid:function(){return 0===n.length}}}(),KNMI.Map.Map=function(){var e,t={},a=new google.maps.Geocoder,n=[],o=null,i=null,r=null,s={center:{lat:51.9029736,lng:4.4587036},zoom:3,minZoom:3,mapTypeControl:!0,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE],style:google.maps.ZoomControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM},disableDoubleClickZoom:!1,panControl:!1,panControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_CENTER},scaleControl:!0,streetViewControl:!1,streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},styles:[{featureType:"all",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"administrative",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{visibility:"on"}]},{featureType:"administrative.country",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"administrative.land_parcel",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"landscape.natural",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.landcover",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.fill",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.stroke",stylers:[{visibility:"simplified"}]},{featureType:"landscape.natural.landcover",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"landscape.natural.terrain",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{visibility:"on"}]},{featureType:"water",elementType:"geometry.fill",
stylers:[{color:"#8fcae7"}]}]},l=8,d=12,c=!1,u=!0,m=null,p={gridSize:30,maxZoom:8,minimumClusterSize:5},f=null,h=!0,g=null,v=function(a){if(a.length){var n=$("#WMS");r=$(".legend-rain_radar"),legendaTab=$(".legend-layers"),rainfallTabPane=$("#rainfall-view"),i=n.is(":checked"),n.on("change",function(){i=n.is(":checked"),i?b():(e.overlayMapTypes.setAt(0,null),r.removeClass("show"),legendaTab.addClass("active"),r.removeClass("active"),rainfallTabPane.removeClass("active"))}),KNMI.browserData.isMobile&&(p={gridSize:75,maxZoom:10,minimumClusterSize:2}),t.map=a,t.inputBoundingBox=$('[name="bbox"]'),google.maps.event.addDomListener(window,"load",M)}},M=function(){e=new google.maps.Map(document.getElementById(t.map.attr("id")),s);var n=function(){a.geocode({address:"The Netherlands"},function(t,a){e.fitBounds(t[0].geometry.bounds),g="zoom-"+e.getZoom(),$("body").addClass(g),w()})};KNMI.Map.Bookmark.hasBookmarkHash()?KNMI.Map.Bookmark.loadBookmark(w,n):n(),google.maps.event.addListener(e,"idle",function(){y(),m=e.getBounds()}),google.maps.event.addListener(e,"dragend",function(){setTimeout(function(){c=!1,u&&h&&w()},50),y()}),google.maps.event.addListener(e,"dragstart",function(){c=!0,y()}),google.maps.event.addListener(e,"zoom_changed",function(){$("body").removeClass(g);var t=e.getZoom();g="zoom-"+t,t>=l?$("body").addClass("show-marker-labels"):$("body").removeClass("show-marker-labels"),$("body").addClass(g),y()}),b()},y=function(){R()},w=function(){KNMI.Components.Request.makeSitesRequest(function(e){k(e)}),u=!1},b=function(){i&&$.ajax({dataType:"json",url:"/get_utc",data:{date:KNMI.Map.MapTime.getCurrentDate()}}).always(function(t){KNMI.Map.Wms.loadWMS(e,t.date),r.addClass("show")})},k=function(t){if(I(),null!==t.sites)for(var a=0,o=t.sites.length;a<o;a++)!function(){var o=t.sites[a],i=new google.maps.LatLng(o.geo.coordinates[1],o.geo.coordinates[0]),r=KNMI.Components.Request.getFilter().layer[0],s=new MapIcon(i,e,o,r);n.push(s)}();C()},C=function(){options=p,f=new MarkerClusterer(e,n,options),f.setCalculator(function(e,t){return clusterData=KNMI.Map.Resolutions.calcClusterData(e),{clusterData:clusterData}})},I=function(){null!==f&&f.clearMarkers(),n=[]},N=function(e){for(var t=0,a=n.length;t<a;t++){var o=n[t];o.data.id==e&&o.focus()}},S=function(e){if("geo"==e.type){var t=new google.maps.LatLng(e.geo.coordinates[1],e.geo.coordinates[0]);D(t),N(e.id)}else a.geocode({address:e.value},function(e,t){t==google.maps.GeocoderStatus.OK?(D(e[0].geometry.location),resolve()):KNMI.Components.InfoWindow.showMessage("error",KNMI.Config.messages.error["location-not-found"])})},D=function(t){e.setZoom(d),e.panTo(t)},T=function(){return m},x=function(){return n},K=function(e){o=e},_=function(){return o},R=function(){o&&(o.remove(),o=null)};return{initialise:v,searchLocation:S,showData:k,loadWMS:b,getBounds:T,fetchNewData:w,getMarkers:x,getActiveToolTip:_,setActiveToolTip:K,removeActiveToolTip:R,status:function(){return{dragged:c}}}}(),KNMI.Map.Wms=function(){var e=function(e,t,a){return null!=t&&(e=Math.max(e,t)),null!=a&&(e=Math.min(e,a)),e},t=function(e){return e*(Math.PI/180)},a=function(e){return e/(Math.PI/180)},n=function(){var e=256;this.pixelOrigin_=new google.maps.Point(e/2,e/2),this.pixelsPerLonDegree_=e/360,this.pixelsPerLonRadian_=e/(2*Math.PI)};return n.prototype.fromLatLngToPoint=function(a,n){var o=this,i=n||new google.maps.Point(0,0),r=o.pixelOrigin_;i.x=r.x+a.lng()*o.pixelsPerLonDegree_;var s=e(Math.sin(t(a.lat())),-.9999,.9999);return i.y=r.y+.5*Math.log((1+s)/(1-s))*-o.pixelsPerLonRadian_,i},n.prototype.fromDivPixelToLatLng=function(e,t){var n=this,o=n.pixelOrigin_,i=Math.pow(2,t),r=(e.x/i-o.x)/n.pixelsPerLonDegree_,s=(e.y/i-o.y)/-n.pixelsPerLonRadian_,l=a(2*Math.atan(Math.exp(s))-Math.PI/2);return new google.maps.LatLng(l,r)},n.prototype.fromDivPixelToSphericalMercator=function(e,a){var n=this,o=n.fromDivPixelToLatLng(e,a),i=6378137,r=i*t(o.lng()),s=t(o.lat()),l=i/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)));return new google.maps.Point(r,l)},loadWMS=function(e,t){var a=256,o=256,i=1,r=!0,s=2,l=28,d=new Date(t);d.setHours(d.getHours()-2);var c="https://geoservices.knmi.nl/adagucserver?",u=["SERVICE=WMS","VERSION=1.3.0","dataset=RADAR","LAYERS=RAD_NL25_PCP_CM","REQUEST=GetMap","WIDTH="+o,"HEIGHT="+a,"CRS=EPSG%3A3857","STYLES=default","FORMAT=image/png","TRANSPARENT=TRUE","time="+d.toISOString()],m={getTileUrl:function(e,t){var a=new google.maps.Point(256*e.x,256*(e.y+1)),o=new google.maps.Point(256*(e.x+1),256*e.y),i=new n,r=i.fromDivPixelToSphericalMercator(a,t),s=i.fromDivPixelToSphericalMercator(o,t),l=r.y,d=r.x,m=s.y,p=s.x;p<d&&(p=Math.abs(p));var f=c+u.join("&")+"&bbox="+d+","+l+","+p+","+m;return f},tileSize:new google.maps.Size(a,o),minZoom:s,maxZoom:l,opacity:parseFloat(i),isPng:r},p=new google.maps.ImageMapType(m);e.overlayMapTypes.setAt(0,p)},{initialise:initialise,bound:e,degreesToRadians:t,radiansToDegrees:a,MercatorProjection:n,loadWMS:loadWMS}}(),KNMI.Map.Resolutions=function(){var e={temperature:{type:"steps",min:-14,max:38,step:2},wind_speed:[0,2.5,5,10,100],wind_direction:[0,15,30,45,60,75,90,105,120,135,150,165,180,195,210,225,240,255,270,285,300,315,330,345,360],rain_rate:{type:"range",values:[0,.2,.5,1,2,5,1e3]},pressure_msl:{type:"steps",min:960,max:1036,step:4},humidity:{type:"steps",min:0,max:100,step:4},soil_moisture:{type:"steps",min:0,max:100,step:4},weather_code:{type:"value-mapping",values:{"res-0":[111],"res-1":[100],"res-2":[112],"res-3":[101],"res-4":[102],"res-5":[14,15,16,20,21,24,25,50,51,52,53,54,55,56,58,60,61,66,80,105],"res-6":[57,59,62,63,67,81],"res-7":[64,65,82,104],"res-8":[68,69,83,84],"res-9":[79,87,88,89,90,108],"res-10":[22,23,26,27,70,71,77,78,85],"res-11":[72,73,74,75,86,106,110],"res-12":[13,17,29,91,92,93,94,95,96,97,98,99,109],"res-13":[6,7,8,9,30,31,32,33,34,35],"res-14":[10],"res-15":[11,12,28,40,41,42,43,44,45,46,47,48,49,103],"res-16":[4,5]}}};valueConversion={temperature:{round:"round"},rain_rate:{round:"onedecimal"},humidity:{round:"round"},pressure_msl:{round:"round"},soil_moisture:{round:"round"}};var t={temperature:{className:"wi-thermometer",index:0},rain:{className:"wi-raindrops",index:1},rain_rate:{className:"wi-showers",index:2},present:{className:"wi-day-cloudy",index:3},wind_speed:{className:"wi-strong-wind",index:4},wind_direction:{className:"wi-wind-direction",index:5},humidity:{className:"wi-humidity",index:6},pressure_msl:{className:"wi-barometer",index:7}},a={dry_bulb_unit:{text:"temperatuur",icon:t.temperature},wet_bulb_unit:{text:"temperatuur",icon:t.temperature},dew_point_unit:{text:"luchtvochtigheid",icon:t.humidity},relative_humidity_unit:{text:"luchtvochtigheid",icon:t.humidity},relative_humidity:{text:"luchtvochtigheid",icon:t.humidity},pressure_unit:{text:"luchtdruk",icon:t.pressure_msl},mslp_unit:{text:"luchtdruk",icon:t.pressure_msl},rainfall_unit:{text:"neerslagintensiteit",icon:t.rain_rate},rainfall_rate_unit:{text:"neerslagintensiteit",icon:t.rain_rate},wind_speed_unit:{text:"windsnelheid",icon:t.wind_speed},wind_dir_unit:{text:"windrichting",icon:t.wind_direction},present_weather_code:{text:"actueel weer",icon:t.present}};return getValue=function(e){if(null===e||void 0===e)return"";var t=KNMI.Components.Request.getFilter().layer[0],a=void 0!==valueConversion[t]?valueConversion[t].round:null,n="",e="wind"!==t?e[t]:e;switch(a){case"round":n=Math.round(e);break;case"onedecimal":n=Math.round(10*e)/10;break;default:n="wind"!==t?e:Math.round(e.speed)}return n},getResolution=function(t,a){var n=KNMI.Components.Request.getFilter().layer[0];if(null===t||null===t[n])return void 0===a&&(a="unknown"),"no-data "+a;var o=e[n],i=null;switch(n){case"wind":var r=null!==t.speed?parseFloat(t.speed):t.speed,s=parseFloat(null!==t.direction?t.direction:0);wind_speedResolutions=e.wind_speed,wind_directionResolutions=e.wind_direction,wind_speedResolution=null,wind_directionResolution=null;for(var l=0;l<wind_speedResolutions.length;l++)r>=wind_speedResolutions[l]&&r<wind_speedResolutions[l+1]&&(wind_speedResolution=l);for(var l=0;l<wind_directionResolutions.length;l++)s>=wind_directionResolutions[l]&&s<wind_directionResolutions[l+1]&&(wind_directionResolution=l);return null===r?(void 0===a&&(a="unknown"),"no-data "+a):r<=.2?"no-wind":"res-"+wind_speedResolution+"-direction-"+wind_directionResolution;default:if("range"===e[n].type)for(var d=parseFloat(null!==t[n]?t[n]:0),l=0;l<e[n].values.length;l++)if(d>=e[n].values[l]&&d<e[n].values[l+1])return"res-"+l;if("steps"===e[n].type){var c=parseFloat(t[n]);c>e[n].max&&(c=e[n].max);var i=Math.floor((c-o.min)/o.step);return"res-"+i}if("none"===e[n].type){var c=t.length?t:0;return"res-"+c}if("value-mapping"===e[n].type){var t=t[n],u=null,m=!1;return jQuery.each(e[n].values,function(e,a){a.indexOf(t)!==-1&&(m=!0,u=e)}),u=null!==u?u:"res-18"}}},calcClusterData=function(e){for(var t=KNMI.Components.Request.getFilter().layer[0],a=[],n=null,o=null,i={layerName:t,hasMedian:!1,totalMarkers:e.length,stationType:"cluster"},r=0,s=e.length;r<s;r++){var l=null;switch(t){case"wind":i.hasMedian=!1;break;default:i.hasMedian=!0,null===n&&(n={},n[t]="null"),null!==e[r].data.property&&(l=parseFloat(e[r].data.property[t]))}isNaN(l)||null===l||a.push(l)}a=a.sort(function(e,t){return e-t});var d=Math.floor(a.length/2);o=a.length%2?a[d]:(a[d-1]+a[d])/2;var c=null,l=null;if("wind"!==t&&"weather_code"!==t)n[t]=o,l=getValue(n),c=getResolution(n);else{var u=e[0];if(l=getValue(u.data.property),isNaN(l)){for(var m=null,p=1;p<e.length;p++){var f=getValue(e[p].data.property);if(!isNaN(f)){m=p;break}}null===m&&(m=0),u=e[m],l=getValue(u.data.property)}c=getResolution(u.data.property,u.data.type)}if(0==a.length&&"wind"!==t&&"weather_code"!==t){l=getValue(null);for(var h=null,g=!1,r=0,s=e.length;r<s;r++)null===h?h=e[r].data.type:h===e[r].data.type||g||(h="cluster-mixed",g=!0);c=getResolution(null,h),i.value=l,i.resolution=c}return i.value=l,i.resolution=c,i},getWeatherIcons=function(e){var t=e,n=[];$.each(t,function(e,a){var o=t[e];$.each(o,function(e,t){for(var a=o.unit,i=0,r=a.length;i<r;i++)"not_captured"!==a[i].value&&null!==a[i].value&&n.push(a[i])})});var o=[],i=$.map(n,function(e){if(void 0!==a[e.code]){var t=a[e.code].icon;if(o.indexOf(t)==-1)return o.push(t),a[e.code]}});return i.sort(function(e,t){return parseFloat(e.icon.index)-parseFloat(t.icon.index)}),i},{getResolution:getResolution,getValue:getValue,calcClusterData:calcClusterData,getWeatherIcons:getWeatherIcons,getWeatherIconSet:function(){return t}}}(),KNMI.Map.MapTime=function(){var e,t=null,a=null,n=null,o=null,i={},r=null,s=null,l=null,d=null,c=144,u=!0,m=3e4,p=KNMI.Config.global.dateFormat,f=function(o){o.length>0&&(t=$('[name="latest_report"]'),a=$('[name="first_report"]'),n=$('[name="date"]'),i.dateFrom=$("#date-from"),i.dateTo=$("#date-to"),i.dateTime=$("#date-time"),r=t.val(),s=moment(r).subtract(1,"day").format(p),l=moment(r).format(p),n.val(moment(r).format(p)),h($("#map-datepicker")),g($("#timeslider")),updateDomDates(),updateDomTime(),e=setInterval(function(){checkForUpdates()},m)),initForwardBackwardBtns(),checkForUpdates()},h=function(e){var n={orientation:"bottom",startDate:moment(a.val()).format("DD-MM-YYYY"),endDate:moment(t.val()).format("DD-MM-YYYY"),autoclose:!0,format:"dd-mm-yyyy",disableSameDate:!0,language:"nl",todayHighlight:!0};datePickerElement=e.datepicker(n),datePickerElement.datepicker("setDate",moment(t.val()).format("DD-MM-YYYY")),datePickerElement.on("changeDate",function(e){var a=moment(e.date).format(p);u=moment(e.date).format("DD-MM-YYYY")==moment(t.val()).format("DD-MM-YYYY"),changeDate(a)})},g=function(e){o=e,o.slider({min:0,max:c,step:1,value:144,formater:function(e){var t=moment(s).add(10*e,"minutes"),a=t.format("HH:mm"),n=t.add(9,"minutes").format("HH:mm");return a+"-"+n}}).on("slideStop",function(e){formattedDate=timeRangeToDate(e.value),changeTime(formattedDate),KNMI.Map.Map.loadWMS()}).on("slide",function(e){var t=moment(s).add(10*e.value,"minutes"),a=t.format("HH:mm"),n=t.add(9,"minutes").format("HH:mm");o.parents(".slider").find(".tooltip-inner").html(a+"-"+n)}),d=c;var t=e.parents(".map-scrubber").find(".map-date-reset");t.on("click",function(){resetDate()})};return timeRangeToDate=function(e){var t=Math.abs(10*e);return d=e,moment(s).add(t,"minutes").format(p)},buildRequest=function(){n.val(moment(r).format(p)),KNMI.Components.Request.makeSitesRequest()},changeTime=function(e){r=e,buildRequest()},resetDate=function(){u=!0,datePickerElement.datepicker("setDate",moment(t.val()).format("DD-MM-YYYY"))},changeDate=function(e){u?(r=moment(t.val()).format(p),s=moment(t.val()).subtract(1,"d").format(p),l=moment(t.val()).format(p),o.data("slider").max=144,o.slider("setValue",144),o.parents(".map-scrubber").removeClass("date-selected")):(r=e,s=e,l=moment(e).add(1,"day").subtract(10,"minutes").format(p),o.data("slider").max=143,o.slider("setValue",0),o.parents(".map-scrubber").addClass("date-selected")),buildRequest(),updateDomDates()},updateDomTime=function(e){void 0===e&&(e=moment(r));e.format("HH:mm"),e.add(9,"minutes").format("HH:mm")},updateDomDates=function(){var e=moment(s).format("DD-MM-YYYY HH:mm");formattedTo=moment(l).add(9,"m").format("DD-MM-YYYY HH:mm"),i.dateFrom.html(e),i.dateTo.html(formattedTo)},checkForUpdates=function(){$.ajax({dataType:"json",url:"/get_latest_report",cache:!1}).always(function(e){try{var t=e.latest_report;if(r<t)if(d===c&&u)KNMI.Map.MapTime.updateView(t),KNMI.Components.InfoWindow.closeInfoWindow(),KNMI.Map.MapTime.resetUpdateTimer();else if(u){var a='Er zijn nieuwe metingen beschikbaar. Klik <a class="reload-btn" href="javascript:void(0)" onClick="KNMI.Map.MapTime.updateView(\''+t+"');KNMI.Components.InfoWindow.closeInfoWindow();KNMI.Map.MapTime.resetUpdateTimer()\" >hier</a> om het scherm te verversen.";KNMI.Components.InfoWindow.showMessage("loading",a,-1)}else KNMI.Components.InfoWindow.closeInfoWindow()}catch(n){}})},initForwardBackwardBtns=function(){var e=$(".range-btn.forward"),t=$(".range-btn.backward"),a=function(e){var t;"forwards"==e?(t=d+1,t>c&&(t=c)):"backwards"==e&&(t=d-1,t<0&&(t=0)),o.slider("setValue",t),changeTime(timeRangeToDate(t))};e.on("click",function(e){e.preventDefault(),a("forwards"),KNMI.Map.Map.loadWMS()}),t.on("click",function(e){e.preventDefault(),a("backwards"),KNMI.Map.Map.loadWMS()})},updateView=function(e){t.val(e),u=!0,changeDate(e),KNMI.Map.Map.loadWMS()},{initialise:f,getFromDate:function(){return s},getToDate:function(){return l},getCurrentDate:function(){return r},getFirstReportDate:function(){return a.val()},getLatestReportDate:function(){return t.val()},updateView:updateView,resetUpdateTimer:function(){clearInterval(e),e=setInterval(function(){checkForUpdates()},m)}}}(),KNMI.Map.Bookmark=function(){var e=this;return initialise=function(){e.bookmark=document.location.hash.replace("#","")},removeBookmarkHash=function(){e.bookmark=null;var t=window.location.href.replace(/#.*$/,"");window.history.replaceState("",document.title,t)},addBookmarkHash=function(t){e.bookmark=t,document.location.hash="#"+e.bookmark},loadBookmark=function(t,a){hasBookmarkHash()?$.ajax({url:"sites/"+e.bookmark}).done(function(e){e.site?(KNMI.Map.Map.searchLocation(Object.assign(e.site,{type:"geo"})),$.ajax({url:"/sites/"+e.site.id+"?report_id="+e.report.id}).done(function(e){KNMI.Site.Modal.openModal(e),t()}).fail(function(){removeBookmarkHash(),a()})):(removeBookmarkHash(),a())}).fail(function(e){removeBookmarkHash(),a()}):a()},hasBookmarkHash=function(){return!!e.bookmark},{initialise:initialise,removeBookmarkHash:removeBookmarkHash,addBookmarkHash:addBookmarkHash,hasBookmarkHash:hasBookmarkHash,loadBookmark:loadBookmark}}(),KNMI.Map.CompareStations=function(){var e=!1,t={},a=null,n=[],o=3e3,i=null,r=2,s=function(){var e=$("#compare-station");t={modal:e,closeBtn:e.find(".close.window"),closeWarning:e.find(".close.info"),list:e.find("#compare-list"),results:e.find(".result-holder"),introMessage:e.find(".intro-message"),stationName:e.find("#compare-name"),compareBtn:e.find("#compare-btn"),errorMessage:e.find(".form-feedback")},t.closeBtn.on("click",function(){c(),g()}),t.compareBtn.on("click",function(){m(),t.modal.removeClass("show")}),t.list.on("click","a",function(e){var t=$(e.target).parents("li"),a=t.attr("data-id");h(t,a),e.preventDefault()}),t.closeWarning.on("click",function(){f(!1)})},l=function(n){e=!0,a=n,KNMI.Site.Modal.closeModal(),t.stationName.html("Vergelijk met station <span>"+(n.site.name||this.site.id)+"</span>"),t.introMessage.html("<strong>Selecteer een station op de kaart (2 maximaal)</strong>"),t.modal.addClass("show"),M()},d=function(){return n},c=function(){e=!1,a=null,t.modal.removeClass("show")},u=function(){return e},m=function(){KNMI.Site.Modal.openModal(a,1),c()},p=function(e,t){for(var a=!1,o=0,i=n.length;o<i;o++)n[o].id==e.id&&(a=!0);n.length==r&&f(!0),!a&&n.length<r&&(n.push(e),M()),t&&t(),KNMI.Site.Modal.isOpened()&&KNMI.Site.Views.Graph.addSitesToCompare()},f=function(e){i&&clearTimeout(i),e?(t.errorMessage.removeClass("hidden"),i=setTimeout(function(){f(!1)},o)):t.errorMessage.addClass("hidden")},h=function(e,t){n.map(function(e,a){e.id==parseInt(t)&&(n.splice(a,1),f(!1))}),M()},g=function(){n=[]},v=function(){return e},M=function(){n.length>0?t.results.removeClass("no-result"):t.results.addClass("no-result");var e=n.map(function(e){return'<li data-id="'+e.id+'">                     '+(e.name||e.id)+'                    <a href="">                         <i href="" class="fa fa-times-circle"></i>                     </a>                 </li>'});t.list.html(e.join("")),t.compareBtn.attr("disabled",!n.length>0)};return{initialise:s,activateCompareMode:l,deactivateCompareMode:c,compareModeActive:u,addStation:p,removeStation:h,getStations:d,clearAllStations:g,isActive:v}}(),KNMI.Site.Modal=function(){var e={},t={},a=null,n={},o=!1,i=function(t){e.modal=t,e.nav=e.modal.find(".nav-tabs a"),r(),s(),n.station_id=e.modal.find(".station-id"),n.coordinates=e.modal.find(".station-location"),n.time=e.modal.find(".measurement-time"),n.date=e.modal.find(".measurement-date"),n.title=e.modal.find(".station-title"),n.rating=e.modal.find(".rating"),$(window).on("popstate",function(){$(".modal").modal("hide")})},r=function(){e.nav.each(function(e,a){var n=$(a).attr("href").slice(1),o=KNMI.Site.Views[n.capitalize()];o.initialise($("#"+n)),t[n]=o})},s=function(){e.modal.on("show.bs.modal",function(){o=!0}),e.modal.on("shown.bs.modal",function(e){}),e.modal.on("hide.bs.modal",function(){o=!1}),e.modal.on("hidden.bs.modal",function(){closeModal()}),e.nav.on("shown.bs.tab",function(e){var t=$(e.target).attr("href").slice(1);showTabContent(t)}),e.nav.on("hide.bs.tab",function(e){var t=$(e.target).attr("href").slice(1);hideTabContent(t)})};return showTabContent=function(e){t[e].show(),"overview"!==e?(n.time.hide(),n.date.hide()):(n.time.show(),n.date.show())},hideTabContent=function(e){t[e].hide()},showGlobalInformation=function(e){var t=e.site.geo.coordinates.reverse().toString(),a=null!==e.report?moment(e.report.measured,KNMI.Config.global.dateFormat):"",o=(moment().zone()/60*-1,e.site.name),i=e.site.id;n.station_id.html(KNMI.Config.titles.globalSite.siteID+" "+i),n.coordinates.html(n.coordinates.find("i")[0].outerHTML+" "+t),n.time.html(""!==a?a.format("HH:mm")+' <span class="gmt">('+e.site.utcoffset_client+")</span>":""),n.date.html(""!==a?a.format("DD-MM-YYYY"):""),n.title.html(o);for(var r=e.site.rating,s=0;s<n.rating.length;s++){var l=$(n.rating[s]);l.removeClass("fa-star").removeClass("fa-star-o"),s<r?l.addClass("fa-star"):l.addClass("fa-star-o")}},openModal=function(n,o){a=n,KNMI.Map.Bookmark.addBookmarkHash(n.site.id);var i=document.location.href;window.history&&window.history.pushState?window.history.pushState("opened_modal",null,""):bajb_backdetect.OnBack=function(){document.location.href=i},KNMI.Map.Map.removeActiveToolTip(),e.modal.modal("show",a),$(e.nav[0]).tab("show"),showGlobalInformation(a),jQuery.each(t,function(e,a){t[e].newSiteData(n)}),showTabContent($(e.nav[0]).attr("href").slice(1)),o&&$(e.nav[o]).tab("show")},showTab=function(t){$(e.nav[t]).tab("show")},closeModal=function(){KNMI.Map.Bookmark.removeBookmarkHash(),KNMI.Components.Validation.resetValidations(),jQuery.each(t,function(e,a){t[e].destroy()}),KNMI.Map.CompareStations.isActive()||KNMI.Map.CompareStations.clearAllStations(),e.modal.modal("hide")},{initialise:i,openModal:openModal,showTab:showTab,isOpened:function(){return o},closeModal:closeModal}}(),KNMI.Site.Views.Graph=function(){var e=new SiteView,t=null,a=null,n=null,o={},i={},r=null,s=null,l=null,d=null,c=null,u=null,m=null,p=null,f=null,h=null,g=null,v=null,M="graph",y=KNMI.Config.global.dateFormat,w="DD-MM-YYYY",b="HH:mm";config=KNMI.Config.graph,layerControls=null,chartDataParent=null,validator=KNMI.Components.Validation;var k=Highcharts.getOptions().exporting.buttons.contextButton.menuItems.splice(2);return e.initialise=function(e){SiteView.prototype.initialise.call(this,e),initChart(),initElements()},e.show=function(t){SiteView.prototype.show.call(this),KNMI.Components.Validation.resetValidations(),prefillForm(),renderCompareStations(),e.data.site.allow_data_download?e.rootNode.find(".export").removeClass("hidden"):e.rootNode.find(".export").addClass("hidden")},e.hide=function(){SiteView.prototype.hide.call(this),hideGraph(),hideTable()},e.addSitesToCompare=function(e){renderCompareStations()},initElements=function(){t=e.rootNode.find("#chart-view"),h=e.rootNode.find("#table-view"),r=e.rootNode.find("#graph-startdate"),s=e.rootNode.find("#graph-starttime"),l=e.rootNode.find("#graph-enddate"),d=e.rootNode.find("#graph-endtime"),timeSelectEl=e.rootNode.find("#graph-time-select"),m=new SearchHelper(e.rootNode.find("#graph-compare_siteid")),compareElHidden=e.rootNode.find("#graph-compare_siteid_hidden"),c=e.rootNode.find(".reset"),u=e.rootNode.find(".update"),f=e.rootNode.find(".graph-switch").find("a"),findNearest=e.rootNode.find(".btn-nearest"),p=e.rootNode.find(".btn.export"),chartDataParent=e.rootNode.find(".graph-data-view"),layerControls=e.rootNode.find('[type="checkbox"]'),g=e.rootNode.find(".table-legend"),v=e.rootNode.find(".site_timezone"),r.on("click",function(){var e=$("tfoot").find(".today");e.on("click",function(){var e=moment().format(w);r.datepicker("setDate",e)}),timeSelectEl.val("custom")}),r.on("change",function(){var e=$(this),t=e.parent().find('[name="start"]'),a=moment(e.val(),w).format(y);s.val("00:00"),t.val(a).trigger("change")}),s.on("click",function(){timeSelectEl.val("custom")}),s.on("change",function(){var e=$(this),t=KNMI.Components.Validation.validateTime(e);if(t){var a=e.val().split(":"),n=a[0],o=a[1],i=moment(r.val(),w).hours(n).minutes(o).format(y),s=r.parent().find('[name="start"]');s.val(i).trigger("change")}}),l.on("click",function(){var e=$("tfoot").find(".today");e.on("click",function(){var e=moment().format(w);l.datepicker("setDate",e)}),timeSelectEl.val("custom")}),l.on("change",function(){var e=$(this),t=e.parent().find('[name="end"]'),a=moment(e.val(),w).endOf("day").format(y);d.val("23:59"),t.val(a).trigger("change")}),d.on("click",function(){timeSelectEl.val("custom")}),d.on("change",function(){var e=$(this),t=KNMI.Components.Validation.validateTime(e);if(t){var a=e.val().split(":"),n=a[0],o=a[1],i=moment(l.val(),w).hours(n).minutes(o).format(y),r=l.parent().find('[name="end"]');r.val(i).trigger("change")}}),timeSelectEl.on("change",function(){setSelectedDate(this.value)}),u.on("click",function(){getFormData()}),c.on("click",function(){resetForm()}),p.on("click",function(){var t=e.rootNode.find("form"),a=t.serialize(),n="/sites/"+e.data.site.id+"/export?";n+=a,exportData(n)});for(var a=0,n=f.length;a<n;a++)!function(){var e=$(f[a]);e.on("click",function(){changeMode(e.attr("data-mode"))})}();var o={orientation:"top",startDate:moment(KNMI.Map.MapTime.getFirstReportDate()).format(w),autoclose:!0,format:w.toLowerCase(),disableSameDate:!0,language:"nl",todayHighlight:!0,todayBtn:!0};r.datepicker(o),l.datepicker(o),m.rootNode.on("valueSelected",function(e,t){KNMI.Map.CompareStations.addStation(t),renderCompareStations()}),e.rootNode.find(".chosen-station-list").on("click","a",function(e){e.preventDefault();var t=$(e.target).parents("li").attr("data-id");removeSiteToCompare(t)}),findNearest.on("click",function(){KNMI.Map.CompareStations.activateCompareMode(e.data)}),KNMI.Components.Validation.initGraphValidations(e.rootNode)},setSelectedDate=function(e){var t=moment();switch(e){case"last24h":var a=moment().subtract(1,"days");setDateInputValues(a,t);break;case"lastWeek":var n=moment().subtract(1,"weeks");setDateInputValues(n,t);break;case"lastMonth":var o=moment().subtract(1,"months");setDateInputValues(o,t);break;default:return}},setDateInputValues=function(e,t){var a=t.format(w),n=t.format(b);l.datepicker("setDate",a),l.val(a),d.val(n);var o=l.parent().find('[name="end"]'),i=t.format(y);o.val(i).trigger("change");var c=e.format(w),u=e.format(b);r.datepicker("setDate",c),r.val(c),s.val(u);var m=r.parent().find('[name="start"]'),p=e.format(y);m.val(p).trigger("change")},exportData=function(e){window.location=e},removeSiteToCompare=function(e){KNMI.Map.CompareStations.removeStation(null,e),renderCompareStations()},resetStations=function(){comparedStations=[],renderCompareStations()},renderCompareStations=function(){var t=e.rootNode.find("form"),a=t.find('input[name="site_ids"]');a.remove();for(var n=KNMI.Map.CompareStations.getStations(),o=0;o<n.length;o++){var i=n[o];t.append('<input type="hidden" name="site_ids" value="'+i.id+'">')}var r=n.map(function(e){return'<li data-id="'+e.id+'">\t\t\t\t\t\t'+(e.name||e.id)+'\t\t\t\t\t<a href="">\t\t\t\t\t\t\t<i class="fa fa-times-circle"></i>\t\t\t\t\t\t</a> \t\t\t\t</li>'});r.length?e.rootNode.addClass("has-compare-stations"):e.rootNode.removeClass("has-compare-stations"),r.length>=2?m.rootNode.attr("disabled",!0):m.rootNode.attr("disabled",!1),e.rootNode.find(".chosen-station-list").empty().html(r.join("")),getFormData()},changeMode=function(e){M=e,"graph"==M&&setTimeout(function(){$(window).trigger("resize")},50)},resetForm=function(){KNMI.Components.Validation.resetValidations(),hideGraph(),hideTable();for(var e=1;e<layerControls.length;e++)$(layerControls[e]).prop("checked",!1);var t=KNMI.Components.Request.getFilter().layer[0];0==layerControls.filter(":checked").length&&layerControls.filter('[value="'+t+'"]').prop("checked",!0).change(),r.val(""),l.val(""),m.rootNode.val(""),compareElHidden.val(""),prefillForm(),resetStations(),KNMI.Components.Validation.activateValidations()},initChart=function(){function e(e){var t={min:null,max:null,tickInterval:null,minRange:null};switch(e){case"direction":t.min=0,t.max=360,t.tickInterval=90;break;case"precipitation":t.min=0,t.minRange=1}return t}Highcharts.setOptions({line:{connectNulls:!1},lang:{loading:"Wordt geladen...",months:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],weekdays:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],shortMonths:["jan","feb","maa","apr","mei","jun","jul","aug","sep","okt","nov","dec"],exportButtonTitle:"Exporteren",printButtonTitle:"Printen",rangeSelectorFrom:"Vanaf",rangeSelectorTo:"Tot",rangeSelectorZoom:"Periode",downloadPNG:"Download als PNG",downloadJPEG:"Download als JPEG",downloadPDF:"Download als PDF",downloadSVG:"Download als SVG",resetZoom:"Reset zoom",resetZoomTitle:"Reset",thousandsSep:".",decimalPoint:"."}});KNMI.Components.Request.makeLayersRequest(function(t){var a=t.axis;jQuery.each(a,function(t,a){var n=t,i=a.title,r=a.style,s=a.unit,l=e(t),d={gridLineWidth:1,allowDecimals:!1,title:{text:i,style:{color:r}},gridLineColor:config.gridLineColorYAxis,labels:{format:"{value} "+s,style:{color:r}},id:n,min:l.min,max:l.max,minRange:l.minRange,tickInterval:l.tickInterval,opposite:!1};o[n]=d});var n=t.layers;jQuery.each(n,function(e,t){if(null!==t&&void 0!==a[t.axis]){var n=e,r=t.name,s=t.type,l=t.color,d=t.axis,c=o[d].labels.format.replace("{value}",""),u={name:r,type:s,yAxis:d,data:[],tooltip:{valueSuffix:c},color:l};i[n]=u}})})},prefillForm=function(){var e=moment(KNMI.Map.MapTime.getFromDate(),y),t=moment(KNMI.Map.MapTime.getLatestReportDate(),y);setDateInputValues(e,t.add(10,"m")),timeSelectEl.val("custom");var a=KNMI.Components.Request.getFilter().layer[0];if(0==layerControls.filter(":checked").length)switch(a){case"wind":layerControls.filter('[value="wind_speed"]').prop("checked",!0).change(),layerControls.filter('[value="wind_direction"]').prop("checked",!0).change();break;case"weather_code":layerControls.filter('[value="temperature"]').prop("checked",!0).change();break;default:layerControls.filter('[value="'+a+'"]').prop("checked",!0).change()}KNMI.Components.Validation.activateValidations()},setLoadingState=function(e){e?chartDataParent.addClass("loading"):chartDataParent.removeClass("loading")},getFormData=function(){if(setLoadingState(!0),KNMI.Components.Validation.isValid()){var t="/sites/"+e.data.site.id+"/measurements?";t+=e.rootNode.find("form").serialize(),KNMI.Components.Request.makeSiteDataRequest(t,function(e){if(void 0!==e[0].measurements&&e[0].measurements.length>0?(a=e[0].measurements,n=e,showData()):showNoData(),void 0!==e[0]&&void 0!==e[1]&&(0==e[1].measurements.length||0==e[0].measurements.length)){var t=0==e[1].measurements.length?e[1].site_id:e[0].site_id;KNMI.Components.InfoWindow.showMessage("error","Station "+t+" mist data.")}setLoadingState(!1)})}},showData=function(){var t=e.rootNode.parents(".modal"),a=chartDataParent.find(".tab-content");createGraph(),createTable(),chartDataParent.removeClass("no-response-data"),a.offset().top>$(window).height()+t.scrollTop()&&setTimeout(function(){t.off("mousewheel").on("mousewheel",function(){t.stop(),t.off("mousewheel")}),t.animate({scrollTop:a.offset().top},1e3,function(){t.off("mousewheel")})},500)},showNoData=function(){hideGraph(),chartDataParent.addClass("no-response-data")},createTable=function(){function t(e,t){return null===t?"-":t}h.find("table").empty();var a={},o=[],i=n.length>1;numberOfSites=n.length;for(var s=0;s<numberOfSites;s++)for(var l=n[s].measurements,d=0;d<n[s].measurements.length;d++){var c=l[d];k=c.measured,b=c.report_id,property=c.property,index=s,siteDataObject={date:k,report_id:b,property:property,index:index},void 0===a[c.measured]&&(i?a[c.measured]=[null,null]:a[c.measured]=[]),a[c.measured][index]=siteDataObject}jQuery.each(a,function(e,t){for(var n=0;n<numberOfSites;n++)if(null==t[n]){var i=0==n?1:0,r=t[i];null===r&&(r=t[2]),a[e][n]={},a[e][n].property={},jQuery.each(r.property,function(t,o){a[e][n].property[t]=null})}o.push(e)}),o=o.sort(function(e,t){var a=new Date(e);return dateB=new Date(t),dateB-a});var u="",m="",p=a[o[0]][0].property;!function(){m+="<thead><tr>",m+="<th>"+KNMI.Config.translateKey("th-date")+"</th>",jQuery.each(p,function(e,t){m+="<th>"+KNMI.Config.translateKey("th-"+e)+"</th>"}),i||(m+="<th>"+KNMI.Config.translateKey("th-details")+"</th>"),m+="</tr></thead>"}();for(var s=0,f=o.length;s<f;s++){var v=a[o[s]],M="<tr>";M+="<td><span>"+moment(o[s],y).format("DD-MM-YYYY HH:mm")+"</span></td>";var w=v[0].property;if(jQuery.each(w,function(e,a){if(i){M+="<td>";for(var n=0,o=v.length;n<o;n++)M+='<span class="site-'+(n+1)+'">'+t(e,v[n].property[e])+"</span>";M+="</td>"}else M+="<td><span>"+t(e,a)+"</span></td>"}),!i){var b=v[0].report_id,k=v[0].date;M+="<td><a href='javascript:void(0)' data-date='"+k+"' data-reportID="+b+">"+KNMI.Config.titles.helpers.checkDetails+"</a></td>"}M+="</tr>",u+=M}if(h.find("table").append($(m+u)),i){g.removeClass("hidden"),g.find(">*").addClass("hidden");for(var s=0,f=n.length;s<f;s++)g.find(".site-"+(s+1)).html("<strong>Station:</strong> "+(null!==n[s].site_name?n[s].site_name:n[s].site_id)).removeClass("hidden")}else g.addClass("hidden");h.find("a").each(function(){var t=$(this);t.on("click",function(){var a="/sites/"+e.data.site.id+"?report_id="+t.attr("data-reportid");KNMI.Components.Request.makeSiteDataRequest(a,function(e){
KNMI.Components.Validation.resetValidations();var a=moment(t.attr("data-date"),y).format(shownDateFormat);r.datepicker("setDate",a),r.val(a),r.parent().find('[name="start"]').val(t.attr("data-date")),KNMI.Site.Modal.openModal(e)})})})},hideTable=function(){h.find("table").empty()},createGraph=function(){function a(e){return JSON.parse(JSON.stringify(e))}for(var r=[],s={},l=n.length>1,d=0,c=n.length;d<c;d++){for(var u=n[d].site_id,m=n[d].site_name,p=n[d].measurements,f={},h=0,g=p.length;h<g;h++){var M=p[h],y=moment.utc(M.measured).toDate().valueOf();jQuery.each(M.property,function(e,t){var n=null===t?null:parseFloat(t);void 0===f[e]&&(f[e]=a(i[e])),f[e].siteID=l===!0?"("+(null!==m?m:u)+")":"",f[e].data.push([y,n])})}r.push(f)}for(var w=0,c=r.length;w<c;w++){var f=r[w];jQuery.each(f,function(e,t){if(l&&w>0){var n=1==w?1:-.3;f[e].color=calcColorLuminance(f[e].color,n)}var i=t.yAxis;void 0===s[i]&&(s[i]=a(o[i]))})}for(var b=[],C=[],I=0,c=r.length;I<c;I++){var w=r[I];jQuery.each(w,function(e,t){b.push(t)})}jQuery.each(s,function(e,t){C.push(t)}),t.highcharts({credits:{enabled:!1},chart:{zoomType:"x",alignTicks:!1,resetZoomButton:{theme:{fill:"white",stroke:"silver",r:0,states:{hover:{fill:"#41739D",style:{color:"white"}}}}}},exporting:{enabled:e.data.site.allow_data_download,buttons:{contextButton:{enabled:!1},exportButton:{text:"Download afbeelding",verticalAlign:"bottom",y:35,menuItems:k}}},navigation:{buttonOptions:{theme:{"stroke-width":0,stroke:"#e6e6e6",fill:"#999",align:"center",verticalAlign:"middle",style:{color:"#fff",align:"center"},states:{hover:{fill:"#e6e6e6",style:{color:"#333",align:"center"}},select:{fill:"#e6e6e6",style:{color:"#333"}}}}}},title:{text:""},subtitle:{text:""},tooltip:{shared:!0,useHTML:!0,headerFormat:'<small>{point.key}</small><table class="table-tooltip">',pointFormat:'<tr><td class="tooltip-name"><span style="color: {series.color}"">●</span> {series.name}: </td><td class="tooltip-point"><b>{point.y}</b></td></tr>',footerFormat:"</table>",valueDecimals:2,crosshairs:{color:config.crossHairColor},borderColor:config.toolTip.borderColor},legend:{layout:"horizontal",align:"center",verticalAlign:"top",x:0,y:0,floating:!1,labelFormatter:function(){return 1==l?this.name+" "+this.options.siteID:this.name},backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{type:"datetime",gridLineColor:config.gridLineColorXAxis,gridLineWidth:1,minTickInterval:18e5,tickColor:config.bottomAxisColor,lineColor:config.bottomAxisColor},yAxis:C,series:b,plotOptions:{series:{connectNulls:!1}}}),v.text("Getoonde tijden zijn "+e.data.site.utcoffset_client)},calcColorLuminance=function(e,t){e=String(e).replace(/[^0-9a-f]/gi,""),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var a,n,o="#";for(n=0;n<3;n++)a=parseInt(e.substr(2*n,2),16),a=Math.round(Math.min(Math.max(0,a+a*t),255)).toString(16),o+=("00"+a).substr(a.length);return o},hideGraph=function(){t.highcharts()&&t.highcharts().destroy()},e}(),KNMI.Site.Views.Information=function(){var e=new SiteView,t=null,a=null,n=null;return e.initialise=function(e){this.rootNode=e,t=this.rootNode.find("table.location-attributes tbody")},e.show=function(){SiteView.prototype.show.call(this),fillLocationAttributes(),calcCoordinates(),fillStationMeasurements(e.data.site.location_attributes),showSmallMap()},e.hide=function(){t.empty()},fillStationMeasurements=function(t){for(var a=e.rootNode.find(".measurements--icons"),n=KNMI.Map.Resolutions.getWeatherIcons(t),o="",i=0,r=n.length;i<r;i++)o+='<li><a class="info-tooltip" data-toggle="tooltip" data-placement="top" href="javascript:void(0)" title="Op dit station wordt '+n[i].text+' gemeten."><i class="wi '+n[i].icon.className+'"></i></a></li>';a.html(o).find(".info-tooltip").tooltip()},showSmallMap=function(){var t=e.data.site.geo.coordinates,o=new google.maps.LatLng(t[0],t[1]);null==n?n=new google.maps.Map(document.getElementById("mini-map")):a&&a.setMap(null);var i={center:o,zoom:14,mapTypeId:google.maps.MapTypeId.HYBRID};google.maps.event.trigger(n,"resize"),n.setOptions(i);var r=KNMI.Components.Request.getFilter().layer[0],s=$.map(KNMI.Map.Map.getMarkers(),function(t){if(t.data.id==e.data.site.id)return t});a=new MapIcon(o,n,s[0].data,r),a.overwriteHTML("temperature res-16",""),a.setMap(n)},calcCoordinates=function(){var t=e.rootNode.find("[data-coordinates]"),a=e.data.site.geo.coordinates,n=a[0]<0?"S":"N",o=a[1]<0?"W":"E",i=String(a[0]);i=i.replace("-","");var r=String(a[1]);r=r.replace("-","");var s="<strong>"+n+" </strong><span>"+i+" </span>";s+="<strong>"+o+" </strong><span>"+r+" </span>",t.html(s)},fillLocationAttributes=function(){for(var a=e.data.site.location_attributes,n=["exposure","temperature","precipitation","wind","ucz","reporting"],o=0;o<n.length;o++)!function(){var e=n[o],i=a[n[o]],r=e+"-"+i.value,s=!1,l="<tr>";l+="<td><span><em>"+KNMI.Config.translateKey(e)+"</em></span><span class='station-type-value'>"+i.value+"</span></td>",l+="<td><a class='info-tooltip' data-toggle='tooltip' data-placement='top' href='javascript:void(0)' title='"+KNMI.Config.translateKey(r)+"'><i class='fa fa-question-circle'></i></a></td><td><span></span></td><td><span></span></td>",l+="</tr>",l=$(l),t.append(l),l.find(".info-tooltip").tooltip();for(var d=0,c=i.unit.length;d<c;d++){var u=i.unit[d].name,m=i.unit[d].value;if("not_captured"==m)return;if(s){var p=$("<tr class='unit'><td></td><td></td><td><span>"+KNMI.Config.translateKey(u)+"</span></td><td><span>"+KNMI.Config.translateKey(m)+"</span></td></tr>");t.append(p)}else $(l.find("td")[2]).find("span").html(KNMI.Config.translateKey(u)),$(l.find("td")[3]).find("span").html(KNMI.Config.translateKey(m)),$(l.find("td")[2]).find("span").addClass("unit"),$(l.find("td")[3]).find("span").addClass("unit"),s=!0}}()},e}(),KNMI.Site.Views.Dayoverview=function(){var e=new SiteView,t=$(".day-overview").find(".loading-message"),a=$(".day-overview").find(".table.table-striped"),n=null,o=$("#day-overview-content");return e.initialise=function(e){SiteView.prototype.initialise.call(this,e)},e.show=function(){SiteView.prototype.show.call(this),n===e.data.report.id||e.data.site.official||(n=e.data.report.id,getOverviewData(),t.show(),a.css("opacity",0)),e.data.site.official&&(t.hide(),o.find(".wow-site-data").removeClass("active"),o.find(".official-site-data").addClass("active"))},e.hide=function(){SiteView.prototype.hide.call(this)},getOverviewData=function(){setLoadingState(!0);var n="/sites/"+e.data.site.id+"/daily_data";o.find(".official-site-data").removeClass("active"),KNMI.Components.Request.makeSiteDataRequest(n,function(e){t.hide(),a.css("opacity",1),fillDataProperties(e),o.find(".wow-site-data").addClass("active")})},fillDataProperties=function(e){for(var t in e)if("data"in e[t])for(var a in e[t].data)for(var n in e[t].data[a]){var o=e[t].data[a][n],i="[data-key*='"+t+"."+a+"."+n+"']";$(i).html(null!==o?o:"-")}},e}(),KNMI.Site.Views.Photos=function(){var e=new SiteView;return e.initialise=function(e){SiteView.prototype.initialise.call(this,e)},e.show=function(){SiteView.prototype.show.call(this)},e.newSiteData=function(e){SiteView.prototype.newSiteData(this,e)},e}(),KNMI.Site.Views.Overview=function(){var e=new SiteView;return e.initialise=function(e){this.rootNode=e},e.show=function(){SiteView.prototype.show.call(this)},e}();